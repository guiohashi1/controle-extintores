<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#121212">
    <title>Relat√≥rios - Controle de Extintores</title>
    
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- jsPDF para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="../js/supabase-config.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/plan-validator.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/navigation.css">
    <link rel="stylesheet" href="../css/dropdowns.css">
    <link rel="stylesheet" href="../css/mobile-enhancements.css">
    <link rel="stylesheet" href="../css/mobile-fixes.css">
    <link rel="stylesheet" href="../css/pwa.css">
</head>
<body>
    <!-- Navigation Bar -->
    <div id="navbar-container"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="screen-header">
            <div>
                <h1>Relat√≥rios</h1>
                <p>Vencimentos e an√°lises</p>
            </div>
            <div id="headerActions">
                <!-- Seletor de plano para demonstra√ß√£o -->
                <div id="demoControls" style="display: flex; gap: 1rem; align-items: center;">
                    <select id="planSelector" onchange="switchPlanDemo()" style="padding: 0.5rem; border-radius: 6px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color);">
                        <option value="starter">Starter (Demo)</option>
                        <option value="professional">Professional (Demo)</option>
                        <option value="enterprise">Enterprise (Demo)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Resumo -->
        <div class="dashboard-grid">
            <div class="card dashboard-card">
                <div class="card-header">
                    <h3>üéØ Resumo Geral</h3>
                </div>
                <div class="dashboard-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalExtintores">-</span>
                        <span class="stat-label">Total</span>
                    </div>
                    <div class="stat-item valid">
                        <span class="stat-number" id="validosCount">-</span>
                        <span class="stat-label">V√°lidos</span>
                    </div>
                    <div class="stat-item warning">
                        <span class="stat-number" id="alertasCount">-</span>
                        <span class="stat-label">Alertas</span>
                    </div>
                    <div class="stat-item expired">
                        <span class="stat-number" id="vencidosCount">-</span>
                        <span class="stat-label">Vencidos</span>
                    </div>
                </div>
            </div>
            
            <div class="card dashboard-card">
                <div class="card-header">
                    <h3>üìä Status dos Extintores</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chartStatus"></canvas>
                </div>
            </div>
            
            <div class="card dashboard-card">
                <div class="card-header">
                    <h3>üè∑Ô∏è Distribui√ß√£o por Tipo</h3>
                </div>
                <div class="chart-container">
                    <canvas id="chartTipos"></canvas>
                </div>
            </div>
        </div>

        <!-- Relat√≥rios Avan√ßados - PROFESSIONAL -->
        <div id="advancedReports" class="advanced-reports-section" style="display: none;">
            <div class="section-header">
                <h2>üìä Relat√≥rios Avan√ßados</h2>
                <span class="pro-badge">PROFESSIONAL</span>
            </div>

            <!-- An√°lise de Tend√™ncias -->
            <div class="card">
                <div class="card-header">
                    <h3>üìà An√°lise de Tend√™ncias</h3>
                    <div class="card-actions">
                        <select id="trendPeriod" onchange="updateTrendAnalysis()" class="form-select">
                            <option value="3">√öltimos 3 meses</option>
                            <option value="6">√öltimos 6 meses</option>
                            <option value="12">√öltimos 12 meses</option>
                            <option value="24">√öltimos 24 meses</option>
                        </select>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
                <div id="trendInsights" class="insights-panel">
                    <!-- Insights ser√£o inseridos aqui -->
                </div>
            </div>

            <!-- An√°lise Preditiva -->
            <div class="card">
                <div class="card-header">
                    <h3>üîÆ An√°lise Preditiva</h3>
                    <div class="card-actions">
                        <select id="predictionPeriod" onchange="updatePredictiveAnalysis()" class="form-select">
                            <option value="30">Pr√≥ximos 30 dias</option>
                            <option value="60">Pr√≥ximos 60 dias</option>
                            <option value="90">Pr√≥ximos 90 dias</option>
                            <option value="180">Pr√≥ximos 6 meses</option>
                            <option value="365">Pr√≥ximo ano</option>
                        </select>
                    </div>
                </div>
                <div class="predictions-grid">
                    <div class="prediction-card">
                        <div class="prediction-icon">üö®</div>
                        <div class="prediction-content">
                            <div class="prediction-number" id="predictedExpirations">-</div>
                            <div class="prediction-label">Vencimentos Previstos</div>
                            <div class="prediction-change" id="expirationTrend"></div>
                        </div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-icon">üí∞</div>
                        <div class="prediction-content">
                            <div class="prediction-number" id="predictedCost">-</div>
                            <div class="prediction-label">Custo Estimado</div>
                            <div class="prediction-change" id="costTrend"></div>
                        </div>
                    </div>
                    <div class="prediction-card">
                        <div class="prediction-icon">üìÖ</div>
                        <div class="prediction-content">
                            <div class="prediction-number" id="peakMonth">-</div>
                            <div class="prediction-label">Pico de Vencimentos</div>
                            <div class="prediction-change" id="peakChange"></div>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="predictionChart"></canvas>
                </div>
            </div>

            <!-- Comparativo de Performance -->
            <div class="card">
                <div class="card-header">
                    <h3>üìä Comparativo de Performance</h3>
                    <div class="card-actions">
                        <button onclick="exportAdvancedReport()" class="btn-export">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7,10 12,15 17,10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Exportar Completo
                        </button>
                    </div>
                </div>
                <div class="performance-tabs">
                    <button class="tab-btn active" onclick="showPerformanceTab('locations')" data-tab="locations">Por Local</button>
                    <button class="tab-btn" onclick="showPerformanceTab('types')" data-tab="types">Por Tipo</button>
                    <button class="tab-btn" onclick="showPerformanceTab('months')" data-tab="months">Por M√™s</button>
                    <button class="tab-btn" onclick="showPerformanceTab('status')" data-tab="status">Por Status</button>
                </div>
                <div class="chart-container">
                    <canvas id="performanceChart"></canvas>
                </div>
                <div id="performanceMetrics" class="metrics-grid">
                    <!-- M√©tricas ser√£o inseridas aqui -->
                </div>
            </div>

            <!-- Alertas Inteligentes -->
            <div class="card">
                <div class="card-header">
                    <h3>ü§ñ Alertas Inteligentes</h3>
                    <div class="card-actions">
                        <button onclick="configureAlerts()" class="btn-config">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"></path>
                            </svg>
                            Configurar
                        </button>
                    </div>
                </div>
                <div id="intelligentAlerts" class="alerts-container">
                    <!-- Alertas inteligentes ser√£o inseridos aqui -->
                </div>
            </div>
        </div>
        
        <!-- Recursos Exclusivos ENTERPRISE -->
        <div id="enterpriseFeatures" class="enterprise-features-section" style="display: none;">
            <div class="section-header">
                <h2>üëë Recursos Exclusivos Enterprise</h2>
                <span class="enterprise-badge">ENTERPRISE</span>
            </div>

            <!-- IA e Machine Learning -->
            <div class="card">
                <div class="card-header">
                    <h3>ü§ñ An√°lise com Intelig√™ncia Artificial</h3>
                    <div class="card-actions">
                        <button onclick="toggleAIAnalysis()" class="btn-ai">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                            IA Ativada
                        </button>
                    </div>
                </div>
                <div class="ai-insights-grid">
                    <div class="ai-card">
                        <div class="ai-icon">üß†</div>
                        <div class="ai-content">
                            <h4>Previs√£o Inteligente</h4>
                            <p>IA analisa padr√µes hist√≥ricos e clima para previs√µes 90% mais precisas</p>
                            <div class="ai-metric" id="aiAccuracy">Precis√£o: 94.2%</div>
                        </div>
                    </div>
                    <div class="ai-card">
                        <div class="ai-icon">üéØ</div>
                        <div class="ai-content">
                            <h4>Otimiza√ß√£o Autom√°tica</h4>
                            <p>Sugest√µes autom√°ticas de redistribui√ß√£o para m√°xima efici√™ncia</p>
                            <div class="ai-metric" id="aiOptimization">Economia: R$ 2.450/m√™s</div>
                        </div>
                    </div>
                    <div class="ai-card">
                        <div class="ai-icon">‚ö°</div>
                        <div class="ai-content">
                            <h4>Detec√ß√£o de Anomalias</h4>
                            <p>Identifica√ß√£o autom√°tica de padr√µes suspeitos ou irregulares</p>
                            <div class="ai-metric" id="aiAnomalies">3 anomalias detectadas</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Executivo -->
            <div class="card">
                <div class="card-header">
                    <h3>üìä Dashboard Executivo</h3>
                    <div class="card-actions">
                        <button onclick="generateExecutiveReport()" class="btn-executive">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                            Relat√≥rio Executivo
                        </button>
                    </div>
                </div>
                <div class="executive-dashboard">
                    <div class="kpi-grid">
                        <div class="kpi-card critical">
                            <div class="kpi-value" id="criticalKPI">97.2%</div>
                            <div class="kpi-label">Taxa de Conformidade</div>
                            <div class="kpi-trend up">+2.1% vs m√™s anterior</div>
                        </div>
                        <div class="kpi-card success">
                            <div class="kpi-value" id="efficiencyKPI">R$ 14.8K</div>
                            <div class="kpi-label">Economia Anual</div>
                            <div class="kpi-trend up">+15.3% vs meta</div>
                        </div>
                        <div class="kpi-card warning">
                            <div class="kpi-value" id="riskKPI">2.4</div>
                            <div class="kpi-label">√çndice de Risco</div>
                            <div class="kpi-trend down">-0.6 vs m√™s anterior</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="executiveChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Integra√ß√£o e API -->
            <div class="card">
                <div class="card-header">
                    <h3>üîó Centro de Integra√ß√µes</h3>
                    <div class="card-actions">
                        <button onclick="manageIntegrations()" class="btn-integration">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                                <polyline points="7.5,4.21 12,6.81 16.5,4.21"></polyline>
                                <polyline points="7.5,19.79 7.5,14.6 3,12"></polyline>
                                <polyline points="21,12 16.5,14.6 16.5,19.79"></polyline>
                            </svg>
                            Gerenciar APIs
                        </button>
                    </div>
                </div>
                <div class="integrations-grid">
                    <div class="integration-card active">
                        <div class="integration-icon">‚òÅÔ∏è</div>
                        <div class="integration-name">Cloud Storage</div>
                        <div class="integration-status">‚úÖ Conectado</div>
                    </div>
                    <div class="integration-card active">
                        <div class="integration-icon">üìß</div>
                        <div class="integration-name">Email Marketing</div>
                        <div class="integration-status">‚úÖ Ativo</div>
                    </div>
                    <div class="integration-card">
                        <div class="integration-icon">üì±</div>
                        <div class="integration-name">Mobile App</div>
                        <div class="integration-status">‚öôÔ∏è Configurar</div>
                    </div>
                    <div class="integration-card">
                        <div class="integration-icon">üîî</div>
                        <div class="integration-name">Slack</div>
                        <div class="integration-status">‚ûï Adicionar</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modal de Upgrade (para usu√°rios Starter) -->
        <div id="upgradeModal" class="modal upgrade-modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>üöÄ Upgrade para Professional</h2>
                    <span class="close" onclick="closeUpgradeModal()">&times;</span>
                </div>
                <div class="modal-body">
                    <div class="upgrade-content">
                        <div class="upgrade-icon">üìä</div>
                        <h3>Desbloqueie Relat√≥rios Avan√ßados</h3>
                        <p>Acesse an√°lises preditivas, tend√™ncias hist√≥ricas e insights inteligentes para otimizar a gest√£o dos seus extintores.</p>
                        
                        <div class="upgrade-features">
                            <div class="feature-item">
                                <span class="feature-icon">üìà</span>
                                <span>An√°lise de tend√™ncias hist√≥ricas</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üîÆ</span>
                                <span>Previs√µes inteligentes</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üìä</span>
                                <span>Comparativos avan√ßados</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">ü§ñ</span>
                                <span>Alertas inteligentes</span>
                            </div>
                            <div class="feature-item">
                                <span class="feature-icon">üìÑ</span>
                                <span>Exporta√ß√µes completas</span>
                            </div>
                        </div>
                        
                        <div class="upgrade-price">
                            <span class="price-label">A partir de</span>
                            <span class="price-value">R$ 197/m√™s</span>
                        </div>
                        
                        <button onclick="redirectToUpgrade()" class="btn-upgrade">
                            Fazer Upgrade Agora
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Relat√≥rios B√°sicos (sempre vis√≠veis) -->
        
        <!-- Relat√≥rio de Vencimentos -->
        <div class="card">
            <div class="card-header">
                <h3>üìÖ Relat√≥rio de Vencimentos</h3>
                <div class="card-actions">
                    <button onclick="exportarRelatorio('excel')" class="btn btn-secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                        </svg>
                        Excel
                    </button>
                    <button onclick="gerarPDF()" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14,2 14,8 20,8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                        </svg>
                        PDF
                    </button>
                </div>
            </div>
            
            <!-- Filtros Avan√ßados -->
            <div class="filtros-avancados">
                <div class="filtros-linha">
                    <div class="filtro-group">
                        <label for="filtroPer√≠odo">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            Per√≠odo:
                        </label>
                        <select id="filtroPer√≠odo" onchange="filtrarPorPeriodo()" class="form-select">
                            <option value="30">Pr√≥ximos 30 dias</option>
                            <option value="60">Pr√≥ximos 60 dias</option>
                            <option value="90">Pr√≥ximos 90 dias</option>
                            <option value="vencidos">J√° vencidos</option>
                            <option value="personalizado">Per√≠odo personalizado</option>
                            <option value="todos">Todos</option>
                        </select>
                    </div>
                    
                    <div class="filtro-group">
                        <label for="filtroTipoRelatorio">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                <line x1="7" y1="7" x2="7.01" y2="7"></line>
                            </svg>
                            Tipo:
                        </label>
                        <select id="filtroTipoRelatorio" onchange="filtrarPorPeriodo()" class="form-select">
                            <option value="">Todos os tipos</option>
                            <option value="√Ågua">√Ågua</option>
                            <option value="CO2">CO2</option>
                            <option value="Espuma">Espuma</option>
                            <option value="P√≥ Qu√≠mico">P√≥ Qu√≠mico</option>
                        </select>
                    </div>
                    
                    <div class="filtro-group">
                        <label for="filtroLocalRelatorio">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                <circle cx="12" cy="10" r="3"></circle>
                            </svg>
                            Local:
                        </label>
                        <select id="filtroLocalRelatorio" onchange="filtrarPorPeriodo()" class="form-select">
                            <option value="">Todos os locais</option>
                        </select>
                    </div>
                </div>
                
                <div class="filtros-linha periodo-personalizado" id="periodoPersonalizado" style="display: none;">
                    <div class="filtro-group">
                        <label for="dataInicio">Data In√≠cio:</label>
                        <input type="date" id="dataInicio" onchange="filtrarPorPeriodo()">
                    </div>
                    <div class="filtro-group">
                        <label for="dataFim">Data Fim:</label>
                        <input type="date" id="dataFim" onchange="filtrarPorPeriodo()">
                    </div>
                </div>
            </div>
            
            <div id="relatorioVencimentos"></div>
        </div>
        
        <!-- Estat√≠sticas por Tipo -->
        <div class="card">
            <div class="card-header">
                <h3>üìä Estat√≠sticas por Tipo</h3>
                <div class="card-actions">
                    <select id="seletorTipo" onchange="mostrarEstatisticasTipo()" class="form-select">
                        <option value="">Selecione um tipo...</option>
                    </select>
                </div>
            </div>
            <div id="estatisticasTipo" class="stats-display">
                <div class="tipo-placeholder">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                        <line x1="7" y1="7" x2="7.01" y2="7"></line>
                    </svg>
                    <p>Selecione um tipo para ver as estat√≠sticas detalhadas</p>
                </div>
            </div>
        </div>
        
        <!-- Estat√≠sticas por Local -->
        <div class="card">
            <div class="card-header">
                <h3>Distribui√ß√£o por Local</h3>
            </div>
            <div id="estatisticasLocal"></div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <div id="bottom-nav-container"></div>

    <script>
        let extintores = [];
        let relatorioAtual = [];

        // Inicializa√ß√£o da p√°gina
        document.addEventListener('DOMContentLoaded', async () => {
            // Verificar se usu√°rio est√° logado
            if (!checkAuth()) return;
            
            // Carregar componentes
            await loadNavbarComponent();
            await loadBottomNavComponent();
            setActiveNavItem('relatorios');
            
            // Carregar dados e gerar relat√≥rios
            await carregarDados();
            await gerarRelatorios();
        });

        async function carregarDados() {
            try {
                extintores = await carregarExtintores();
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                showNotification('Erro ao carregar dados para relat√≥rios', 'error');
            }
        }

        async function gerarRelatorios() {
            gerarDashboard();
            gerarGraficos();
            popularFiltrosLocais();
            popularSeletorTipos();
            gerarRelatorioVencimentos();
            gerarEstatisticasLocal();
            
            // Verificar se deve mostrar relat√≥rios avan√ßados
            await verificarPlanoEMostrarRecursos();
        }

        function gerarDashboard() {
            const hoje = new Date();
            let validos = 0, alertas = 0, vencidos = 0;

            extintores.forEach(ext => {
                const status = calcularStatusValidade(ext.validade);
                switch(status) {
                    case 'valid':
                        validos++;
                        break;
                    case 'warning':
                        alertas++;
                        break;
                    case 'expired':
                        vencidos++;
                        break;
                }
            });

            document.getElementById('totalExtintores').textContent = extintores.length;
            document.getElementById('validosCount').textContent = validos;
            document.getElementById('alertasCount').textContent = alertas;
            document.getElementById('vencidosCount').textContent = vencidos;
        }

        function popularFiltrosLocais() {
            const locaisUnicos = [...new Set(extintores.map(ext => ext.local))].sort();
            const filtroLocal = document.getElementById('filtroLocalRelatorio');
            
            // Limpar op√ß√µes existentes mantendo "Todos os locais"
            filtroLocal.innerHTML = '<option value="">Todos os locais</option>';
            
            locaisUnicos.forEach(local => {
                if (local) {
                    const option = document.createElement('option');
                    option.value = local;
                    option.textContent = local;
                    filtroLocal.appendChild(option);
                }
            });
        }

        function gerarGraficos() {
            gerarGraficoStatus();
            gerarGraficoTipos();
        }

        function gerarGraficoStatus() {
            const ctx = document.getElementById('chartStatus').getContext('2d');
            const hoje = new Date();
            let validos = 0, alertas = 0, vencidos = 0;

            extintores.forEach(ext => {
                const status = calcularStatusValidade(ext.validade);
                switch(status) {
                    case 'valid':
                        validos++;
                        break;
                    case 'warning':
                        alertas++;
                        break;
                    case 'expired':
                        vencidos++;
                        break;
                }
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['V√°lidos', 'Pr√≥x. Vencimento', 'Vencidos'],
                    datasets: [{
                        data: [validos, alertas, vencidos],
                        backgroundColor: [
                            '#10b981', // Verde para v√°lidos
                            '#f59e0b', // Amarelo para alertas
                            '#ef4444'  // Vermelho para vencidos
                        ],
                        borderWidth: 2,
                        borderColor: '#1f2937'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                color: '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }

        function gerarGraficoTipos() {
            const ctx = document.getElementById('chartTipos').getContext('2d');
            
            // Tipos fixos e suas cores
            const tiposFixos = ['√Ågua', 'CO2', 'Espuma', 'P√≥ Qu√≠mico'];
            const cores = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b'];
            
            // Contar extintores por tipo
            const dadosTipos = tiposFixos.map(tipo => {
                return extintores.filter(ext => ext.tipo === tipo).length;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: tiposFixos,
                    datasets: [{
                        label: 'Quantidade',
                        data: dadosTipos,
                        backgroundColor: cores,
                        borderColor: cores.map(color => color + '80'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#374151'
                            },
                            ticks: {
                                color: '#e5e7eb'
                            }
                        },
                        x: {
                            grid: {
                                color: '#374151'
                            },
                            ticks: {
                                color: '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }

        function filtrarPorPeriodo() {
            const periodo = document.getElementById('filtroPer√≠odo').value;
            const tipoFiltro = document.getElementById('filtroTipoRelatorio').value;
            const localFiltro = document.getElementById('filtroLocalRelatorio').value;
            
            // Mostrar/esconder per√≠odo personalizado
            const periodoPersonalizado = document.getElementById('periodoPersonalizado');
            if (periodo === 'personalizado') {
                periodoPersonalizado.style.display = 'flex';
            } else {
                periodoPersonalizado.style.display = 'none';
            }
            
            gerarRelatorioVencimentos(periodo, tipoFiltro, localFiltro);
        }

        function gerarRelatorioVencimentos(filtro = '30', tipoFiltro = '', localFiltro = '') {
            const hoje = new Date();
            let extintoresFiltrados = [...extintores];

            // Filtrar por tipo se especificado
            if (tipoFiltro) {
                extintoresFiltrados = extintoresFiltrados.filter(ext => ext.tipo === tipoFiltro);
            }

            // Filtrar por local se especificado
            if (localFiltro) {
                extintoresFiltrados = extintoresFiltrados.filter(ext => ext.local === localFiltro);
            }

            // Filtrar por per√≠odo
            if (filtro === 'vencidos') {
                extintoresFiltrados = extintoresFiltrados.filter(ext => {
                    const vencimento = new Date(ext.validade);
                    return vencimento < hoje;
                });
            } else if (filtro === 'personalizado') {
                const dataInicio = document.getElementById('dataInicio').value;
                const dataFim = document.getElementById('dataFim').value;
                
                if (dataInicio && dataFim) {
                    const inicio = new Date(dataInicio);
                    const fim = new Date(dataFim);
                    
                    extintoresFiltrados = extintoresFiltrados.filter(ext => {
                        const vencimento = new Date(ext.validade);
                        return vencimento >= inicio && vencimento <= fim;
                    });
                }
            } else if (filtro !== 'todos') {
                const diasFuturos = parseInt(filtro);
                const dataLimite = new Date();
                dataLimite.setDate(hoje.getDate() + diasFuturos);
                
                extintoresFiltrados = extintoresFiltrados.filter(ext => {
                    const vencimento = new Date(ext.validade);
                    return vencimento >= hoje && vencimento <= dataLimite;
                });
            }

            // Ordenar por data de vencimento
            extintoresFiltrados.sort((a, b) => new Date(a.validade) - new Date(b.validade));
            
            relatorioAtual = extintoresFiltrados;
            renderizarRelatorioVencimentos(extintoresFiltrados, filtro, tipoFiltro, localFiltro);
        }

        function renderizarRelatorioVencimentos(extintores, filtro, tipoFiltro = '', localFiltro = '') {
            const container = document.getElementById('relatorioVencimentos');
            
            if (extintores.length === 0) {
                container.innerHTML = `
                    <div class="relatorio-empty">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 6v6l4 2"></path>
                        </svg>
                        <p>Nenhum extintor encontrado para os filtros selecionados</p>
                    </div>
                `;
                return;
            }

            // Criar descri√ß√£o dos filtros aplicados
            let filtrosAplicados = [];
            
            if (filtro === 'vencidos') {
                filtrosAplicados.push('vencidos');
            } else if (filtro === 'personalizado') {
                const dataInicio = document.getElementById('dataInicio').value;
                const dataFim = document.getElementById('dataFim').value;
                if (dataInicio && dataFim) {
                    filtrosAplicados.push(`per√≠odo de ${formatDate(dataInicio)} a ${formatDate(dataFim)}`);
                }
            } else if (filtro !== 'todos') {
                filtrosAplicados.push(`pr√≥ximos ${filtro} dias`);
            }
            
            if (tipoFiltro) {
                filtrosAplicados.push(`tipo: ${tipoFiltro}`);
            }
            
            if (localFiltro) {
                filtrosAplicados.push(`local: ${localFiltro}`);
            }

            let descricaoFiltros = filtrosAplicados.length > 0 ? 
                ` (${filtrosAplicados.join(', ')})` : '';

            let html = `<div class="relatorio-resumo">
                <div class="resumo-info">
                    <span class="resumo-count">üìã <strong>${extintores.length}</strong> extintor${extintores.length > 1 ? 'es' : ''} encontrado${extintores.length > 1 ? 's' : ''}</span>
                    ${descricaoFiltros ? `<span class="resumo-filtros">${descricaoFiltros}</span>` : ''}
                </div>
                <div class="resumo-acoes">
                    <button onclick="exportarRelatorio('csv')" class="btn-mini">CSV</button>
                    <button onclick="exportarRelatorio('excel')" class="btn-mini">Excel</button>
                    <button onclick="gerarPDF()" class="btn-mini">PDF</button>
                </div>
            </div>`;

            html += '<div class="relatorio-lista">';
            
            extintores.forEach(ext => {
                const diasRestantes = calcularDiasRestantes(ext.validade);
                const status = calcularStatusValidade(ext.validade);
                const statusBadge = getStatusBadge(status, diasRestantes);
                
                html += `
                    <div class="relatorio-item ${status}">
                        <div class="item-info">
                            <div class="item-header">
                                <span class="item-numero">${ext.numero}</span>
                                <span class="status-badge ${statusBadge.class}">${statusBadge.text}</span>
                            </div>
                            <div class="item-details">
                                <span class="item-local">${ext.local}</span>
                                <span class="item-tipo">${ext.tipo} (${ext.peso}kg)</span>
                                <span class="item-vencimento">Vence em: ${formatDate(ext.validade)}</span>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function popularSeletorTipos() {
            const seletorTipo = document.getElementById('seletorTipo');
            
            // Tipos fixos dispon√≠veis
            const tiposFixos = ['√Ågua', 'CO2', 'Espuma', 'P√≥ Qu√≠mico'];
            
            // Limpar op√ß√µes existentes mantendo "Selecione um tipo..."
            seletorTipo.innerHTML = '<option value="">Selecione um tipo...</option>';
            
            tiposFixos.forEach(tipo => {
                const option = document.createElement('option');
                option.value = tipo;
                option.textContent = tipo;
                seletorTipo.appendChild(option);
            });
        }

        function mostrarEstatisticasTipo() {
            const tipoSelecionado = document.getElementById('seletorTipo').value;
            const container = document.getElementById('estatisticasTipo');
            
            if (!tipoSelecionado) {
                container.innerHTML = `
                    <div class="tipo-placeholder">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                        </svg>
                        <p>Selecione um tipo para ver as estat√≠sticas detalhadas</p>
                    </div>
                `;
                return;
            }

            // Filtrar extintores do tipo selecionado
            const extintoresTipo = extintores.filter(ext => ext.tipo === tipoSelecionado);
            
            // Calcular estat√≠sticas
            let validos = 0, alertas = 0, vencidos = 0;
            const locais = {};
            const pesos = {};
            
            extintoresTipo.forEach(ext => {
                const status = calcularStatusValidade(ext.validade);
                switch(status) {
                    case 'valid':
                        validos++;
                        break;
                    case 'warning':
                        alertas++;
                        break;
                    case 'expired':
                        vencidos++;
                        break;
                }
                
                // Contar por local
                locais[ext.local] = (locais[ext.local] || 0) + 1;
                
                // Contar por peso
                const pesoKey = `${ext.peso}kg`;
                pesos[pesoKey] = (pesos[pesoKey] || 0) + 1;
            });

            container.innerHTML = `
                <div class="tipo-detalhes">
                    <div class="tipo-header">
                        <h4>${tipoSelecionado}</h4>
                        <span class="tipo-total">${extintoresTipo.length} extintor${extintoresTipo.length > 1 ? 'es' : ''}</span>
                    </div>
                    
                    <div class="stats-principais">
                        <div class="mini-stat valid">
                            <span class="mini-number">${validos}</span>
                            <span class="mini-label">V√°lidos</span>
                        </div>
                        <div class="mini-stat warning">
                            <span class="mini-number">${alertas}</span>
                            <span class="mini-label">Pr√≥x. Venc.</span>
                        </div>
                        <div class="mini-stat expired">
                            <span class="mini-number">${vencidos}</span>
                            <span class="mini-label">Vencidos</span>
                        </div>
                    </div>
                    
                    <div class="detalhes-grid">
                        <div class="detalhe-secao">
                            <h5>üìç Por Local</h5>
                            <div class="lista-detalhes">
                                ${Object.entries(locais)
                                    .sort(([,a], [,b]) => b - a)
                                    .slice(0, 5)
                                    .map(([local, count]) => `
                                        <div class="item-detalhe">
                                            <span class="item-nome">${local}</span>
                                            <span class="item-count">${count}</span>
                                        </div>
                                    `).join('')}
                                ${Object.keys(locais).length > 5 ? 
                                    `<div class="item-detalhe-mais">+${Object.keys(locais).length - 5} locais</div>` : ''}
                            </div>
                        </div>
                        
                        <div class="detalhe-secao">
                            <h5>‚öñÔ∏è Por Peso</h5>
                            <div class="lista-detalhes">
                                ${Object.entries(pesos)
                                    .sort(([,a], [,b]) => b - a)
                                    .map(([peso, count]) => `
                                        <div class="item-detalhe">
                                            <span class="item-nome">${peso}</span>
                                            <span class="item-count">${count}</span>
                                        </div>
                                    `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function gerarEstatisticasLocal() {
            const localCount = {};
            
            extintores.forEach(ext => {
                if (!localCount[ext.local]) {
                    localCount[ext.local] = 0;
                }
                localCount[ext.local]++;
            });

            const container = document.getElementById('estatisticasLocal');
            
            if (Object.keys(localCount).length === 0) {
                container.innerHTML = '<div class="relatorio-empty"><p>Nenhum dado dispon√≠vel</p></div>';
                return;
            }

            let html = '<div class="locais-lista">';
            
            Object.entries(localCount)
                .sort(([,a], [,b]) => b - a)
                .forEach(([local, count]) => {
                    const porcentagem = ((count / extintores.length) * 100).toFixed(1);
                    html += `
                        <div class="local-item">
                            <div class="local-info">
                                <span class="local-nome">${local}</span>
                                <span class="local-count">${count} extintor${count > 1 ? 'es' : ''} (${porcentagem}%)</span>
                            </div>
                            <div class="local-barra">
                                <div class="barra-progresso" style="width: ${porcentagem}%"></div>
                            </div>
                        </div>
                    `;
                });
            
            html += '</div>';
            container.innerHTML = html;
        }

        async function exportarRelatorio(formato) {
            if (relatorioAtual.length === 0) {
                showNotification('Nenhum dado para exportar', 'warning');
                return;
            }

            const dados = relatorioAtual.map(ext => ({
                'N√∫mero': ext.numero,
                'Local': ext.local,
                'Tipo': ext.tipo,
                'Peso': `${ext.peso}kg`,
                'Validade': formatDate(ext.validade),
                'Teste Hidrost√°tico': formatDate(ext.hidro),
                'Status': (() => {
                    const dias = calcularDiasRestantes(ext.validade);
                    return dias < 0 ? 'Vencido' : dias <= 30 ? 'Pr√≥ximo vencimento' : 'V√°lido';
                })(),
                'Dias Restantes': calcularDiasRestantes(ext.validade),
                'Observa√ß√µes': ext.observacoes || ''
            }));

            if (formato === 'csv') {
                exportarCSV(dados);
            } else if (formato === 'excel') {
                exportarExcel(dados);
            }
        }

        function exportarCSV(dados) {
            const headers = Object.keys(dados[0]);
            const csvContent = [
                headers.join(';'),
                ...dados.map(row => headers.map(header => `"${row[header] || ''}"`).join(';'))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `relatorio-extintores-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('CSV exportado com sucesso!');
        }

        function exportarExcel(dados) {
            // Para Excel, vamos usar uma tabela HTML convertida
            let html = '<table>';
            html += '<tr>';
            Object.keys(dados[0]).forEach(header => {
                html += `<th>${header}</th>`;
            });
            html += '</tr>';
            
            dados.forEach(row => {
                html += '<tr>';
                Object.values(row).forEach(value => {
                    html += `<td>${value || ''}</td>`;
                });
                html += '</tr>';
            });
            html += '</table>';

            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `relatorio-extintores-${new Date().toISOString().split('T')[0]}.xls`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Excel exportado com sucesso!');
        }

        async function gerarPDF() {
            if (relatorioAtual.length === 0) {
                showNotification('Nenhum dado para gerar PDF', 'warning');
                return;
            }

            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // T√≠tulo
                doc.setFontSize(18);
                doc.text('Relat√≥rio de Extintores', 20, 20);
                
                // Data de gera√ß√£o
                doc.setFontSize(12);
                doc.text(`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`, 20, 30);
                
                // Preparar dados para tabela
                const tableData = relatorioAtual.map(ext => {
                    const dias = calcularDiasRestantes(ext.validade);
                    const status = dias < 0 ? 'Vencido' : dias <= 30 ? 'Pr√≥ximo vencimento' : 'V√°lido';
                    
                    return [
                        ext.numero,
                        ext.local,
                        ext.tipo,
                        `${ext.peso}kg`,
                        formatDate(ext.validade),
                        status
                    ];
                });

                // Gerar tabela
                doc.autoTable({
                    head: [['N√∫mero', 'Local', 'Tipo', 'Peso', 'Validade', 'Status']],
                    body: tableData,
                    startY: 40,
                    styles: { fontSize: 8 },
                    headStyles: { fillColor: [239, 68, 68] }
                });

                // Salvar PDF
                const fileName = `relatorio-extintores-${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                
                showNotification('PDF gerado com sucesso!');
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                showNotification('Erro ao gerar PDF', 'error');
            }
        }

        // ============ FUN√á√ïES DOS RELAT√ìRIOS AVAN√áADOS ============

        async function verificarPlanoEMostrarRecursos() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    console.log('Usu√°rio n√£o autenticado');
                    adicionarBotaoRelatoriosAvancados();
                    return;
                }

                const { data: userData } = await supabase
                    .from('users')
                    .select('plano_ativo')
                    .eq('id', user.id)
                    .single();

                const planAtual = userData?.plano_ativo || 'starter';
                console.log('Plano atual do usu√°rio:', planAtual);
                
                // Verificar se tem acesso a relat√≥rios avan√ßados (PROFESSIONAL ou ENTERPRISE)
                if (PlanValidator.hasFeature(planAtual, 'reports', 'advanced') || 
                    PlanValidator.hasFeature(planAtual, 'reports', 'premium')) {
                    
                    console.log('‚úÖ Usu√°rio tem acesso aos relat√≥rios avan√ßados');
                    document.getElementById('advancedReports').style.display = 'block';
                    await inicializarRelatoriosAvancados();
                    
                    // Adicionar indicador do plano no cabe√ßalho
                    adicionarIndicadorPlano(planAtual);
                    
                    // Se for Enterprise, mostrar recursos exclusivos
                    if (planAtual === 'enterprise') {
                        console.log('üèÜ Ativando recursos Enterprise');
                        document.getElementById('enterpriseFeatures').style.display = 'block';
                        await inicializarRecursosEnterprise();
                    }
                } else {
                    console.log('‚ùå Usu√°rio n√£o tem acesso aos relat√≥rios avan√ßados');
                    // Adicionar bot√£o para acessar relat√≥rios avan√ßados (mostrar√° modal de upgrade)
                    adicionarBotaoRelatoriosAvancados();
                }
            } catch (error) {
                console.error('Erro ao verificar plano:', error);
                adicionarBotaoRelatoriosAvancados();
            }
        }

        async function inicializarRelatoriosAvancados() {
            // Inicializar todos os gr√°ficos avan√ßados
            await Promise.all([
                updateTrendAnalysis(),
                updatePredictiveAnalysis(),
                showPerformanceTab('locations'),
                generateIntelligentAlerts()
            ]);
        }

        // ===== AN√ÅLISE DE TEND√äNCIAS =====
        async function updateTrendAnalysis() {
            const period = document.getElementById('trendPeriod').value || '12';
            const monthsBack = parseInt(period);
            
            // Gerar dados simulados para an√°lise de tend√™ncias
            const trendData = generateTrendData(monthsBack);
            
            // Atualizar gr√°fico
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // Destruir gr√°fico anterior se existir
            if (window.trendChart) {
                window.trendChart.destroy();
            }
            
            window.trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: trendData.labels,
                    datasets: [
                        {
                            label: 'Vencimentos',
                            data: trendData.expirations,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Novos Cadastros',
                            data: trendData.additions,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#e5e7eb'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' }
                        },
                        y: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' },
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gerar insights
            generateTrendInsights(trendData);
        }

        function generateTrendData(monthsBack) {
            const today = new Date();
            const labels = [];
            const expirations = [];
            const additions = [];
            
            for (let i = monthsBack; i >= 0; i--) {
                const date = new Date(today);
                date.setMonth(date.getMonth() - i);
                
                const monthName = date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
                labels.push(monthName);
                
                // Simular dados baseados nos extintores reais
                const baseExpirations = Math.floor(extintores.length * 0.05); // 5% dos extintores por m√™s
                const variation = Math.random() * 0.5 + 0.75; // Varia√ß√£o de 75% a 125%
                
                expirations.push(Math.max(0, Math.floor(baseExpirations * variation)));
                additions.push(Math.max(0, Math.floor(baseExpirations * 0.8 * variation)));
            }
            
            return { labels, expirations, additions };
        }

        function generateTrendInsights(trendData) {
            const container = document.getElementById('trendInsights');
            
            const totalExpirations = trendData.expirations.reduce((a, b) => a + b, 0);
            const avgPerMonth = Math.round(totalExpirations / trendData.expirations.length);
            const lastMonth = trendData.expirations[trendData.expirations.length - 1];
            const prevMonth = trendData.expirations[trendData.expirations.length - 2];
            const trend = lastMonth > prevMonth ? 'alta' : lastMonth < prevMonth ? 'baixa' : 'est√°vel';
            
            const insights = [
                {
                    icon: 'üìä',
                    text: `M√©dia de ${avgPerMonth} vencimentos por m√™s nos √∫ltimos ${trendData.labels.length} meses`
                },
                {
                    icon: trend === 'alta' ? 'üìà' : trend === 'baixa' ? 'üìâ' : '‚û°Ô∏è',
                    text: `Tend√™ncia ${trend} - ${Math.abs(lastMonth - prevMonth)} vencimentos ${trend === 'alta' ? 'a mais' : 'a menos'} que o m√™s anterior`
                },
                {
                    icon: 'üéØ',
                    text: `${Math.round((lastMonth / avgPerMonth - 1) * 100)}% ${lastMonth > avgPerMonth ? 'acima' : 'abaixo'} da m√©dia hist√≥rica`
                }
            ];
            
            container.innerHTML = `
                <h4><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h4m6-6h4a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2h-4m-6 0V9a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H9a2 2 0 0 1-2-2z"></path>
                </svg> Insights Autom√°ticos</h4>
                ${insights.map(insight => `
                    <div class="insight-item">
                        <div class="insight-icon">${insight.icon}</div>
                        <div class="insight-text">${insight.text}</div>
                    </div>
                `).join('')}
            `;
        }

        // ===== AN√ÅLISE PREDITIVA =====
        async function updatePredictiveAnalysis() {
            const period = document.getElementById('predictionPeriod').value || '90';
            const daysAhead = parseInt(period);
            
            const predictions = calculatePredictions(daysAhead);
            
            // Atualizar n√∫meros preditivos
            document.getElementById('predictedExpirations').textContent = predictions.totalExpirations;
            document.getElementById('predictedCost').textContent = `R$ ${predictions.estimatedCost.toLocaleString('pt-BR')}`;
            document.getElementById('peakMonth').textContent = predictions.peakMonth;
            
            // Atualizar tend√™ncias
            updatePredictionTrends(predictions);
            
            // Gerar gr√°fico preditivo
            generatePredictionChart(predictions);
        }

        function calculatePredictions(daysAhead) {
            const today = new Date();
            const futureDate = new Date(today);
            futureDate.setDate(today.getDate() + daysAhead);
            
            // Filtrar extintores que vencem no per√≠odo
            const expiringExtintores = extintores.filter(ext => {
                const expDate = new Date(ext.validade);
                return expDate >= today && expDate <= futureDate;
            });
            
            // Calcular custo estimado (R$ 150 por extintor)
            const costPerExtinguisher = 150;
            const estimatedCost = expiringExtintores.length * costPerExtinguisher;
            
            // Encontrar m√™s de pico
            const monthCounts = {};
            expiringExtintores.forEach(ext => {
                const month = new Date(ext.validade).toLocaleDateString('pt-BR', { month: 'short' });
                monthCounts[month] = (monthCounts[month] || 0) + 1;
            });
            
            const peakMonth = Object.keys(monthCounts).reduce((a, b) => 
                monthCounts[a] > monthCounts[b] ? a : b, Object.keys(monthCounts)[0]) || 'N/A';
            
            return {
                totalExpirations: expiringExtintores.length,
                estimatedCost,
                peakMonth,
                monthlyData: monthCounts,
                weeklyData: generateWeeklyPredictions(expiringExtintores)
            };
        }

        function generateWeeklyPredictions(expiringExtintores) {
            const weeks = [];
            const today = new Date();
            
            for (let i = 0; i < 12; i++) { // 12 semanas
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() + (i * 7));
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                
                const count = expiringExtintores.filter(ext => {
                    const expDate = new Date(ext.validade);
                    return expDate >= weekStart && expDate <= weekEnd;
                }).length;
                
                weeks.push({
                    label: `Sem ${i + 1}`,
                    count
                });
            }
            
            return weeks;
        }

        function updatePredictionTrends(predictions) {
            const avgMonthly = predictions.totalExpirations / 3; // Estimativa baseada em 3 meses
            const currentRate = predictions.totalExpirations;
            const change = ((currentRate - avgMonthly) / avgMonthly * 100).toFixed(1);
            
            const expirationTrend = document.getElementById('expirationTrend');
            const costTrend = document.getElementById('costTrend');
            const peakChange = document.getElementById('peakChange');
            
            // Tend√™ncia de vencimentos
            const trendClass = change > 0 ? 'positive' : change < 0 ? 'negative' : 'neutral';
            expirationTrend.className = `prediction-change ${trendClass}`;
            expirationTrend.textContent = `${change > 0 ? '+' : ''}${change}% vs m√©dia`;
            
            // Tend√™ncia de custo
            costTrend.className = `prediction-change ${trendClass}`;
            costTrend.textContent = `${change > 0 ? '+' : ''}${change}% vs m√©dia`;
            
            // Mudan√ßa do pico
            peakChange.className = 'prediction-change neutral';
            peakChange.textContent = 'Proje√ß√£o atual';
        }

        function generatePredictionChart(predictions) {
            const ctx = document.getElementById('predictionChart').getContext('2d');
            
            if (window.predictionChart) {
                window.predictionChart.destroy();
            }
            
            window.predictionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: predictions.weeklyData.map(w => w.label),
                    datasets: [{
                        label: 'Vencimentos Previstos',
                        data: predictions.weeklyData.map(w => w.count),
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: '#3b82f6',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e5e7eb' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' }
                        },
                        y: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ===== COMPARATIVO DE PERFORMANCE =====
        async function showPerformanceTab(tabType) {
            // Atualizar tabs ativas
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-tab') === tabType) {
                    btn.classList.add('active');
                }
            });
            
            // Gerar gr√°fico espec√≠fico
            generatePerformanceChart(tabType);
            updatePerformanceMetrics(tabType);
        }

        function generatePerformanceChart(tabType) {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            
            if (window.performanceChart) {
                window.performanceChart.destroy();
            }
            
            let chartData = {};
            
            switch (tabType) {
                case 'locations':
                    chartData = generateLocationChart();
                    break;
                case 'types':
                    chartData = generateTypeChart();
                    break;
                case 'months':
                    chartData = generateMonthChart();
                    break;
                case 'status':
                    chartData = generateStatusChart();
                    break;
            }
            
            window.performanceChart = new Chart(ctx, chartData);
        }

        function generateLocationChart() {
            const locationData = {};
            extintores.forEach(ext => {
                locationData[ext.local] = (locationData[ext.local] || 0) + 1;
            });
            
            const sortedData = Object.entries(locationData)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 10); // Top 10 locais
            
            return {
                type: 'doughnut',
                data: {
                    labels: sortedData.map(([local]) => local),
                    datasets: [{
                        data: sortedData.map(([, count]) => count),
                        backgroundColor: [
                            '#3b82f6', '#8b5cf6', '#10b981', '#f59e0b',
                            '#ef4444', '#06b6d4', '#84cc16', '#f97316',
                            '#6366f1', '#ec4899'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#e5e7eb' }
                        }
                    }
                }
            };
        }

        function generateIntelligentAlerts() {
            const alerts = [];
            const hoje = new Date();
            
            // Alerta 1: Vencimentos cr√≠ticos
            const vencimentosCriticos = extintores.filter(ext => {
                const dias = calcularDiasRestantes(ext.validade);
                return dias >= 0 && dias <= 7;
            });
            
            if (vencimentosCriticos.length > 0) {
                alerts.push({
                    priority: 'high',
                    icon: 'üö®',
                    title: 'Vencimentos Cr√≠ticos',
                    description: `${vencimentosCriticos.length} extintor${vencimentosCriticos.length > 1 ? 'es' : ''} vence${vencimentosCriticos.length === 1 ? '' : 'm'} nos pr√≥ximos 7 dias`,
                    time: 'Agora',
                    action: 'Revisar urgentemente'
                });
            }
            
            // Alerta 2: Concentra√ß√£o excessiva
            const locationCount = {};
            extintores.forEach(ext => {
                locationCount[ext.local] = (locationCount[ext.local] || 0) + 1;
            });
            
            const maxLocation = Object.entries(locationCount)
                .sort(([,a], [,b]) => b - a)[0];
            
            if (maxLocation && maxLocation[1] > extintores.length * 0.4) {
                alerts.push({
                    priority: 'medium',
                    icon: 'üìç',
                    title: 'Concentra√ß√£o Alta',
                    description: `${((maxLocation[1] / extintores.length) * 100).toFixed(1)}% dos extintores est√£o no ${maxLocation[0]}`,
                    time: 'Hoje',
                    action: 'Considerar redistribui√ß√£o'
                });
            }
            
            // Alerta 3: Baixa diversifica√ß√£o
            const typeCount = Object.keys({});
            extintores.forEach(ext => {
                typeCount[ext.tipo] = true;
            });
            
            if (Object.keys(typeCount).length < 3) {
                alerts.push({
                    priority: 'low',
                    icon: 'üè∑Ô∏è',
                    title: 'Baixa Diversifica√ß√£o',
                    description: `Apenas ${Object.keys(typeCount).length} tipos diferentes de extintores cadastrados`,
                    time: 'Esta semana',
                    action: 'Avaliar necessidades'
                });
            }
            
            const container = document.getElementById('intelligentAlerts');
            
            if (alerts.length === 0) {
                container.innerHTML = `
                    <div class="alert-item">
                        <div class="alert-icon low">‚úÖ</div>
                        <div class="alert-content">
                            <div class="alert-title">Tudo em ordem!</div>
                            <div class="alert-description">N√£o h√° alertas cr√≠ticos no momento</div>
                            <div class="alert-meta">
                                <span>√öltima verifica√ß√£o: Agora</span>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                container.innerHTML = alerts.map(alert => `
                    <div class="alert-item">
                        <div class="alert-icon ${alert.priority}">${alert.icon}</div>
                        <div class="alert-content">
                            <div class="alert-title">${alert.title}</div>
                            <div class="alert-description">${alert.description}</div>
                            <div class="alert-meta">
                                <span>${alert.time}</span>
                                <span>‚Ä¢</span>
                                <span>${alert.action}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function adicionarBotaoRelatoriosAvancados() {
            const container = document.getElementById('headerActions');
            if (container && !document.getElementById('btnAdvancedReports')) {
                const button = document.createElement('button');
                button.id = 'btnAdvancedReports';
                button.className = 'btn btn-premium';
                button.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
                    </svg>
                    Relat√≥rios Avan√ßados
                    <span class="pro-badge-mini">PRO</span>
                `;
                button.onclick = () => showUpgradeModal();
                container.appendChild(button);
            }
        }

        function adicionarIndicadorPlano(plano) {
            const container = document.getElementById('headerActions');
            if (container && !document.getElementById('planIndicator')) {
                const indicator = document.createElement('div');
                indicator.id = 'planIndicator';
                indicator.className = 'plan-indicator';
                
                const planConfig = {
                    'professional': {
                        name: 'Professional',
                        color: 'linear-gradient(45deg, #3b82f6, #8b5cf6)',
                        icon: '‚≠ê'
                    },
                    'enterprise': {
                        name: 'Enterprise',
                        color: 'linear-gradient(45deg, #8b5cf6, #ec4899)',
                        icon: 'üëë'
                    }
                };
                
                const config = planConfig[plano] || planConfig['professional'];
                
                indicator.innerHTML = `
                    <div class="plan-badge" style="background: ${config.color}">
                        <span class="plan-icon">${config.icon}</span>
                        <span class="plan-name">${config.name}</span>
                    </div>
                `;
                container.appendChild(indicator);
            }
        }

        async function inicializarRelatoriosAvancados() {
            try {
                await Promise.all([
                    updateTrendAnalysis(),
                    updatePredictiveAnalysis(),
                    showPerformanceTab('locations'),
                    loadIntelligentAlerts()
                ]);
            } catch (error) {
                console.error('Erro ao inicializar relat√≥rios avan√ßados:', error);
            }
        }

        async function updateTrendAnalysis() {
            const period = document.getElementById('trendPeriod')?.value || '6';
            const months = parseInt(period);
            
            // Simular dados hist√≥ricos (em produ√ß√£o, viria do banco)
            const trendData = generateTrendData(months);
            
            // Criar gr√°fico de tend√™ncia
            const ctx = document.getElementById('trendChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: trendData.labels,
                        datasets: [{
                            label: 'Vencimentos',
                            data: trendData.expirations,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Novos Cadastros',
                            data: trendData.additions,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#e5e7eb' }
                            }
                        },
                        scales: {
                            x: { ticks: { color: '#e5e7eb' }, grid: { color: '#374151' } },
                            y: { ticks: { color: '#e5e7eb' }, grid: { color: '#374151' } }
                        }
                    }
                });
            }
            
            // Gerar insights
            generateTrendInsights(trendData);
        }

        function generateTrendData(months) {
            const labels = [];
            const expirations = [];
            const additions = [];
            
            const today = new Date();
            
            for (let i = months - 1; i >= 0; i--) {
                const date = new Date(today.getFullYear(), today.getMonth() - i, 1);
                labels.push(date.toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' }));
                
                // Simular dados baseados nos extintores atuais
                const monthExpirations = extintores.filter(ext => {
                    const expDate = new Date(ext.validade);
                    return expDate.getFullYear() === date.getFullYear() && 
                           expDate.getMonth() === date.getMonth();
                }).length;
                
                expirations.push(monthExpirations);
                additions.push(Math.floor(Math.random() * 5) + 1); // Simular novos cadastros
            }
            
            return { labels, expirations, additions };
        }

        function generateTrendInsights(trendData) {
            const container = document.getElementById('trendInsights');
            if (!container) return;
            
            const avgExpirations = trendData.expirations.reduce((a, b) => a + b, 0) / trendData.expirations.length;
            const recentExpirations = trendData.expirations.slice(-3).reduce((a, b) => a + b, 0) / 3;
            const trend = recentExpirations > avgExpirations ? 'increase' : 'decrease';
            
            container.innerHTML = `
                <h4><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 11H1l6-6 6 6z"></path>
                    <path d="M9 13h2l6 6 6-6z"></path>
                </svg> Insights da An√°lise</h4>
                <div class="insight-item">
                    <div class="insight-icon">${trend === 'increase' ? 'üìà' : 'üìâ'}</div>
                    <div class="insight-text">
                        <strong>Tend√™ncia ${trend === 'increase' ? 'crescente' : 'decrescente'}</strong>: 
                        Os vencimentos nos √∫ltimos 3 meses ${trend === 'increase' ? 'aumentaram' : 'diminu√≠ram'} 
                        ${Math.abs(((recentExpirations - avgExpirations) / avgExpirations) * 100).toFixed(1)}% 
                        comparado √† m√©dia hist√≥rica.
                    </div>
                </div>
                <div class="insight-item">
                    <div class="insight-icon">üìÖ</div>
                    <div class="insight-text">
                        <strong>Padr√£o sazonal</strong>: 
                        Maior concentra√ß√£o de vencimentos observada em ${trendData.labels[trendData.expirations.indexOf(Math.max(...trendData.expirations))]}.
                    </div>
                </div>
            `;
        }

        async function updatePredictiveAnalysis() {
            const period = parseInt(document.getElementById('predictionPeriod')?.value || '90');
            
            const predictions = calculatePredictions(period);
            
            document.getElementById('predictedExpirations').textContent = predictions.expirations;
            document.getElementById('predictedCost').textContent = `R$ ${predictions.cost.toLocaleString()}`;
            document.getElementById('peakMonth').textContent = predictions.peakMonth;
            
            // Adicionar indicadores de tend√™ncia
            document.getElementById('expirationTrend').textContent = predictions.expirationTrend;
            document.getElementById('expirationTrend').className = `prediction-change ${predictions.expirationTrend.includes('+') ? 'negative' : 'positive'}`;
            
            document.getElementById('costTrend').textContent = predictions.costTrend;
            document.getElementById('costTrend').className = `prediction-change ${predictions.costTrend.includes('+') ? 'negative' : 'positive'}`;
            
            document.getElementById('peakChange').textContent = predictions.peakChange;
            document.getElementById('peakChange').className = 'prediction-change neutral';
            
            // Gr√°fico preditivo
            createPredictionChart(predictions);
        }

        function calculatePredictions(days) {
            const today = new Date();
            const endDate = new Date(today.getTime() + days * 24 * 60 * 60 * 1000);
            
            const futureExpirations = extintores.filter(ext => {
                const expDate = new Date(ext.validade);
                return expDate >= today && expDate <= endDate;
            });
            
            // Calcular custos estimados (valores simulados)
            const avgCost = 150; // Custo m√©dio de manuten√ß√£o por extintor
            const totalCost = futureExpirations.length * avgCost;
            
            // Encontrar m√™s com mais vencimentos
            const monthCounts = {};
            futureExpirations.forEach(ext => {
                const month = new Date(ext.validade).toLocaleDateString('pt-BR', { month: 'long' });
                monthCounts[month] = (monthCounts[month] || 0) + 1;
            });
            
            const peakMonth = Object.keys(monthCounts).reduce((a, b) => 
                monthCounts[a] > monthCounts[b] ? a : b, Object.keys(monthCounts)[0]) || 'N/A';
            
            // Comparar com per√≠odo anterior para tend√™ncias
            const previousPeriod = extintores.filter(ext => {
                const expDate = new Date(ext.validade);
                const prevStart = new Date(today.getTime() - days * 24 * 60 * 60 * 1000);
                return expDate >= prevStart && expDate < today;
            }).length;
            
            const change = futureExpirations.length - previousPeriod;
            const changePercent = previousPeriod > 0 ? ((change / previousPeriod) * 100).toFixed(0) : 0;
            
            return {
                expirations: futureExpirations.length,
                cost: totalCost,
                peakMonth: peakMonth,
                expirationTrend: change > 0 ? `+${changePercent}%` : `${changePercent}%`,
                costTrend: change > 0 ? `+R$ ${(change * avgCost).toLocaleString()}` : `-R$ ${Math.abs(change * avgCost).toLocaleString()}`,
                peakChange: `${monthCounts[peakMonth] || 0} extintores`,
                chartData: futureExpirations
            };
        }

        function createPredictionChart(predictions) {
            const ctx = document.getElementById('predictionChart');
            if (!ctx) return;
            
            // Agrupar por semana
            const weeklyData = groupByWeeks(predictions.chartData, parseInt(document.getElementById('predictionPeriod').value));
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: weeklyData.labels,
                    datasets: [{
                        label: 'Vencimentos Previstos',
                        data: weeklyData.values,
                        backgroundColor: 'rgba(239, 68, 68, 0.6)',
                        borderColor: '#ef4444',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#e5e7eb' } }
                    },
                    scales: {
                        x: { ticks: { color: '#e5e7eb' }, grid: { color: '#374151' } },
                        y: { ticks: { color: '#e5e7eb' }, grid: { color: '#374151' } }
                    }
                }
            });
        }

        function groupByWeeks(expirations, totalDays) {
            const labels = [];
            const values = [];
            const today = new Date();
            
            const weeks = Math.ceil(totalDays / 7);
            
            for (let i = 0; i < weeks; i++) {
                const weekStart = new Date(today.getTime() + i * 7 * 24 * 60 * 60 * 1000);
                const weekEnd = new Date(today.getTime() + (i + 1) * 7 * 24 * 60 * 60 * 1000);
                
                labels.push(`Sem ${i + 1}`);
                
                const weekExpirations = expirations.filter(ext => {
                    const expDate = new Date(ext.validade);
                    return expDate >= weekStart && expDate < weekEnd;
                }).length;
                
                values.push(weekExpirations);
            }
            
            return { labels, values };
        }

        function showPerformanceTab(tab) {
            // Atualizar tabs ativos
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });
            
            // Criar gr√°fico baseado na tab
            createPerformanceChart(tab);
            updatePerformanceMetrics(tab);
        }

        function createPerformanceChart(type) {
            const ctx = document.getElementById('performanceChart');
            if (!ctx) return;
            
            let data, labels, chartType = 'bar';
            
            switch (type) {
                case 'locations':
                    const locationCounts = {};
                    extintores.forEach(ext => {
                        locationCounts[ext.local] = (locationCounts[ext.local] || 0) + 1;
                    });
                    labels = Object.keys(locationCounts).slice(0, 10);
                    data = labels.map(loc => locationCounts[loc]);
                    break;
                    
                case 'types':
                    const typeCounts = {};
                    extintores.forEach(ext => {
                        typeCounts[ext.tipo] = (typeCounts[ext.tipo] || 0) + 1;
                    });
                    labels = Object.keys(typeCounts);
                    data = labels.map(type => typeCounts[type]);
                    chartType = 'doughnut';
                    break;
                    
                case 'months':
                    labels = [];
                    data = [];
                    for (let i = 11; i >= 0; i--) {
                        const date = new Date();
                        date.setMonth(date.getMonth() - i);
                        labels.push(date.toLocaleDateString('pt-BR', { month: 'short' }));
                        
                        const monthExpirations = extintores.filter(ext => {
                            const expDate = new Date(ext.validade);
                            return expDate.getMonth() === date.getMonth() && 
                                   expDate.getFullYear() === date.getFullYear();
                        }).length;
                        
                        data.push(monthExpirations);
                    }
                    chartType = 'line';
                    break;
                    
                case 'status':
                    let valid = 0, warning = 0, expired = 0;
                    extintores.forEach(ext => {
                        const status = calcularStatusValidade(ext.validade);
                        switch(status) {
                            case 'valid': valid++; break;
                            case 'warning': warning++; break;
                            case 'expired': expired++; break;
                        }
                    });
                    labels = ['V√°lidos', 'Alertas', 'Vencidos'];
                    data = [valid, warning, expired];
                    chartType = 'pie';
                    break;
            }
            
            new Chart(ctx, {
                type: chartType,
                data: {
                    labels,
                    datasets: [{
                        label: 'Quantidade',
                        data,
                        backgroundColor: chartType === 'line' ? 'rgba(59, 130, 246, 0.6)' : [
                            '#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444', 
                            '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#6366f1'
                        ],
                        borderColor: chartType === 'line' ? '#3b82f6' : '#1f2937',
                        borderWidth: 1,
                        tension: chartType === 'line' ? 0.4 : 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { color: '#e5e7eb' } }
                    },
                    scales: chartType === 'line' || chartType === 'bar' ? {
                        x: { ticks: { color: '#e5e7eb' }, grid: { color: '#374151' } },
                        y: { ticks: { color: '#e5e7eb' }, grid: { color: '#374151' } }
                    } : {}
                }
            });
        }

        function updatePerformanceMetrics(type) {
            const container = document.getElementById('performanceMetrics');
            if (!container) return;
            
            let metrics = [];
            
            switch (type) {
                case 'locations':
                    const locations = [...new Set(extintores.map(ext => ext.local))];
                    const avgPerLocation = extintores.length / locations.length;
                    const mostPopulated = locations.reduce((max, loc) => {
                        const count = extintores.filter(ext => ext.local === loc).length;
                        return count > (extintores.filter(ext => ext.local === max).length || 0) ? loc : max;
                    }, locations[0]);
                    
                    metrics = [
                        { label: 'Total de Locais', value: locations.length },
                        { label: 'M√©dia por Local', value: avgPerLocation.toFixed(1) },
                        { label: 'Local c/ Mais Extintores', value: mostPopulated },
                        { label: 'Cobertura', value: '100%' }
                    ];
                    break;
                    
                case 'types':
                    const types = [...new Set(extintores.map(ext => ext.tipo))];
                    const mostCommonType = types.reduce((max, type) => {
                        const count = extintores.filter(ext => ext.tipo === type).length;
                        return count > (extintores.filter(ext => ext.tipo === max).length || 0) ? type : max;
                    }, types[0]);
                    
                    metrics = [
                        { label: 'Tipos Diferentes', value: types.length },
                        { label: 'Mais Comum', value: mostCommonType },
                        { label: 'Diversidade', value: `${((types.length / 4) * 100).toFixed(0)}%` },
                        { label: 'Distribui√ß√£o', value: 'Balanceada' }
                    ];
                    break;
                    
                case 'months':
                    const currentMonth = new Date().getMonth();
                    const thisMonthExpirations = extintores.filter(ext => {
                        const expDate = new Date(ext.validade);
                        return expDate.getMonth() === currentMonth;
                    }).length;
                    
                    metrics = [
                        { label: 'Este M√™s', value: thisMonthExpirations },
                        { label: 'Pr√≥ximo M√™s', value: 'TBD' },
                        { label: 'Tend√™ncia', value: 'Est√°vel' },
                        { label: 'Previs√£o Anual', value: (thisMonthExpirations * 12).toString() }
                    ];
                    break;
                    
                case 'status':
                    let valid = 0, warning = 0, expired = 0;
                    extintores.forEach(ext => {
                        const status = calcularStatusValidade(ext.validade);
                        switch(status) {
                            case 'valid': valid++; break;
                            case 'warning': warning++; break;
                            case 'expired': expired++; break;
                        }
                    });
                    
                    metrics = [
                        { label: 'Taxa de Conformidade', value: `${((valid / extintores.length) * 100).toFixed(1)}%` },
                        { label: 'Em Alerta', value: `${warning} (${((warning / extintores.length) * 100).toFixed(1)}%)` },
                        { label: 'Cr√≠ticos', value: `${expired} (${((expired / extintores.length) * 100).toFixed(1)}%)` },
                        { label: 'Status Geral', value: expired > 0 ? 'Aten√ß√£o' : valid > warning ? 'Bom' : 'Regular' }
                    ];
                    break;
            }
            
            container.innerHTML = metrics.map(metric => `
                <div class="metric-item">
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        async function loadIntelligentAlerts() {
            const container = document.getElementById('intelligentAlerts');
            if (!container) return;
            
            const alerts = generateIntelligentAlerts();
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert-item">
                    <div class="alert-icon ${alert.priority}">
                        ${alert.icon}
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-description">${alert.description}</div>
                        <div class="alert-meta">
                            <span>Prioridade: ${alert.priorityText}</span>
                            <span>‚Ä¢</span>
                            <span>${alert.timeframe}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function generateIntelligentAlerts() {
            const alerts = [];
            const today = new Date();
            
            // Alerta de vencimentos pr√≥ximos cr√≠ticos
            const criticalExpirations = extintores.filter(ext => {
                const expDate = new Date(ext.validade);
                const daysUntil = Math.ceil((expDate - today) / (1000 * 60 * 60 * 24));
                return daysUntil <= 7 && daysUntil > 0;
            });
            
            if (criticalExpirations.length > 0) {
                alerts.push({
                    icon: 'üö®',
                    priority: 'high',
                    priorityText: 'Alta',
                    title: `${criticalExpirations.length} extintor${criticalExpirations.length > 1 ? 'es vencem' : ' vence'} em 7 dias`,
                    description: `A√ß√£o imediata necess√°ria para ${criticalExpirations.map(ext => ext.numero).join(', ')}`,
                    timeframe: 'Pr√≥ximos 7 dias'
                });
            }
            
            // Alerta de padr√£o de vencimentos
            const monthlyExpirations = {};
            extintores.forEach(ext => {
                const month = new Date(ext.validade).getMonth();
                monthlyExpirations[month] = (monthlyExpirations[month] || 0) + 1;
            });
            
            const maxMonth = Object.keys(monthlyExpirations).reduce((a, b) => 
                monthlyExpirations[a] > monthlyExpirations[b] ? a : b);
            
            if (monthlyExpirations[maxMonth] > extintores.length * 0.3) {
                alerts.push({
                    icon: 'üìÖ',
                    priority: 'medium',
                    priorityText: 'M√©dia',
                    title: 'Concentra√ß√£o de vencimentos detectada',
                    description: `${monthlyExpirations[maxMonth]} extintores vencem em ${new Date(2024, maxMonth).toLocaleDateString('pt-BR', { month: 'long' })}`,
                    timeframe: 'Planejamento necess√°rio'
                });
            }
            
            // Alerta de diversifica√ß√£o de tipos
            const types = [...new Set(extintores.map(ext => ext.tipo))];
            if (types.length < 3) {
                alerts.push({
                    icon: '‚öñÔ∏è',
                    priority: 'low',
                    priorityText: 'Baixa',
                    title: 'Baixa diversifica√ß√£o de tipos',
                    description: 'Considere diversificar os tipos de extintores para melhor cobertura',
                    timeframe: 'Avalia√ß√£o recomendada'
                });
            }
            
            return alerts;
        }

        async function exportAdvancedReport() {
            const currentPlan = await getCurrentUserPlan();
            
            if (!PlanValidator.hasFeature(currentPlan, 'reports', 'advanced')) {
                showUpgradeModal();
                return;
            }
            
            // Implementar exporta√ß√£o avan√ßada
            showNotification('Exportando relat√≥rio completo...', 'info');
            
            setTimeout(() => {
                showNotification('Relat√≥rio avan√ßado exportado com sucesso!', 'success');
            }, 2000);
        }

        function configureAlerts() {
            showNotification('Configura√ß√£o de alertas em desenvolvimento', 'info');
        }

        function showUpgradeModal() {
            document.getElementById('upgradeModal').style.display = 'block';
        }

        function closeUpgradeModal() {
            document.getElementById('upgradeModal').style.display = 'none';
        }

        function redirectToUpgrade() {
            window.location.href = '../pages/planos.html';
        }

        async function getCurrentUserPlan() {
            try {
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) return 'starter';

                const { data: userData } = await supabase
                    .from('users')
                    .select('plano_ativo')
                    .eq('id', user.id)
                    .single();

                return userData?.plano_ativo || 'starter';
            } catch (error) {
                console.error('Erro ao obter plano do usu√°rio:', error);
                return 'starter';
            }
        }

        // ===== FUN√á√ïES ADICIONAIS DOS GR√ÅFICOS AVAN√áADOS =====

        function configureAlerts() {
            showNotification('Configura√ß√£o de alertas em desenvolvimento', 'info');
        }

        function generateTypeChart() {
            const typeData = {};
            extintores.forEach(ext => {
                typeData[ext.tipo] = (typeData[ext.tipo] || 0) + 1;
            });
            
            return {
                type: 'bar',
                data: {
                    labels: Object.keys(typeData),
                    datasets: [{
                        label: 'Quantidade',
                        data: Object.values(typeData),
                        backgroundColor: ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' }
                        },
                        y: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' },
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        function generateMonthChart() {
            const monthData = {};
            extintores.forEach(ext => {
                const month = new Date(ext.validade).toLocaleDateString('pt-BR', { month: 'short' });
                monthData[month] = (monthData[month] || 0) + 1;
            });
            
            const months = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 
                          'jul', 'ago', 'set', 'out', 'nov', 'dez'];
            
            return {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Vencimentos por M√™s',
                        data: months.map(month => monthData[month] || 0),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e5e7eb' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' }
                        },
                        y: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' },
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        function generateStatusChart() {
            let validos = 0, alertas = 0, vencidos = 0;
            
            extintores.forEach(ext => {
                const status = calcularStatusValidade(ext.validade);
                switch(status) {
                    case 'valid': validos++; break;
                    case 'warning': alertas++; break;
                    case 'expired': vencidos++; break;
                }
            });
            
            return {
                type: 'bar',
                data: {
                    labels: ['V√°lidos', 'Pr√≥x. Vencimento', 'Vencidos'],
                    datasets: [{
                        label: 'Quantidade',
                        data: [validos, alertas, vencidos],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' }
                        },
                        y: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' },
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        function updatePerformanceMetrics(tabType) {
            const container = document.getElementById('performanceMetrics');
            let metrics = [];
            
            switch (tabType) {
                case 'locations':
                    const locationCount = {};
                    extintores.forEach(ext => {
                        locationCount[ext.local] = (locationCount[ext.local] || 0) + 1;
                    });
                    
                    const totalLocations = Object.keys(locationCount).length;
                    const avgPerLocation = (extintores.length / totalLocations).toFixed(1);
                    const maxLocation = Math.max(...Object.values(locationCount));
                    
                    metrics = [
                        { value: totalLocations, label: 'Total de Locais' },
                        { value: avgPerLocation, label: 'M√©dia por Local' },
                        { value: maxLocation, label: 'Maior Concentra√ß√£o' }
                    ];
                    break;
                    
                case 'types':
                    const typeCount = {};
                    extintores.forEach(ext => {
                        typeCount[ext.tipo] = (typeCount[ext.tipo] || 0) + 1;
                    });
                    
                    const totalTypes = Object.keys(typeCount).length;
                    const mostCommon = Object.keys(typeCount).reduce((a, b) => 
                        typeCount[a] > typeCount[b] ? a : b);
                    
                    metrics = [
                        { value: totalTypes, label: 'Tipos Diferentes' },
                        { value: mostCommon, label: 'Mais Comum' },
                        { value: `${((typeCount[mostCommon] / extintores.length) * 100).toFixed(1)}%`, label: 'Domin√¢ncia' }
                    ];
                    break;
                    
                case 'months':
                    const hoje = new Date();
                    const proximos30 = extintores.filter(ext => {
                        const dias = calcularDiasRestantes(ext.validade);
                        return dias >= 0 && dias <= 30;
                    }).length;
                    
                    metrics = [
                        { value: proximos30, label: 'Pr√≥ximos 30 dias' },
                        { value: Math.round(extintores.length / 12), label: 'M√©dia Mensal' },
                        { value: `${((proximos30 / extintores.length) * 100).toFixed(1)}%`, label: 'Taxa Cr√≠tica' }
                    ];
                    break;
                    
                case 'status':
                    let validosCount = 0, alertasCount = 0, vencidosCount = 0;
                    extintores.forEach(ext => {
                        const status = calcularStatusValidade(ext.validade);
                        switch(status) {
                            case 'valid': validosCount++; break;
                            case 'warning': alertasCount++; break;
                            case 'expired': vencidosCount++; break;
                        }
                    });
                    
                    metrics = [
                        { value: `${((validosCount / extintores.length) * 100).toFixed(1)}%`, label: 'Taxa de Conformidade' },
                        { value: `${((alertasCount / extintores.length) * 100).toFixed(1)}%`, label: 'Em Alerta' },
                        { value: `${((vencidosCount / extintores.length) * 100).toFixed(1)}%`, label: 'Taxa Cr√≠tica' }
                    ];
                    break;
            }
            
            container.innerHTML = metrics.map(metric => `
                <div class="metric-item">
                    <div class="metric-value">${metric.value}</div>
                    <div class="metric-label">${metric.label}</div>
                </div>
            `).join('');
        }

        // ============ FUN√á√ïES DOS RECURSOS ENTERPRISE ============

        async function inicializarRecursosEnterprise() {
            console.log('üèÜ Inicializando recursos Enterprise...');
            await Promise.all([
                initializeAIFeatures(),
                generateExecutiveDashboard(),
                loadIntegrations()
            ]);
        }

        async function initializeAIFeatures() {
            // Simular an√°lise de IA
            const aiData = {
                accuracy: (Math.random() * 5 + 90).toFixed(1), // 90-95%
                optimization: Math.floor(Math.random() * 3000 + 2000), // R$ 2000-5000
                anomalies: Math.floor(Math.random() * 5 + 1) // 1-5 anomalias
            };

            document.getElementById('aiAccuracy').textContent = `Precis√£o: ${aiData.accuracy}%`;
            document.getElementById('aiOptimization').textContent = `Economia: R$ ${aiData.optimization.toLocaleString('pt-BR')}/m√™s`;
            document.getElementById('aiAnomalies').textContent = `${aiData.anomalies} anomalias detectadas`;

            // Animar contadores
            animateCounters();
        }

        function animateCounters() {
            const counters = document.querySelectorAll('.ai-metric');
            counters.forEach(counter => {
                counter.style.opacity = '0';
                setTimeout(() => {
                    counter.style.transition = 'all 0.5s ease';
                    counter.style.opacity = '1';
                    counter.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        counter.style.transform = 'scale(1)';
                    }, 200);
                }, Math.random() * 1000);
            });
        }

        async function generateExecutiveDashboard() {
            // Atualizar KPIs executivos
            const kpis = {
                conformidade: (Math.random() * 5 + 95).toFixed(1),
                economia: Math.floor(Math.random() * 10000 + 10000),
                risco: (Math.random() * 2 + 1).toFixed(1)
            };

            document.getElementById('criticalKPI').textContent = `${kpis.conformidade}%`;
            document.getElementById('efficiencyKPI').textContent = `R$ ${(kpis.economia/1000).toFixed(1)}K`;
            document.getElementById('riskKPI').textContent = kpis.risco;

            // Gerar gr√°fico executivo
            generateExecutiveChart();
        }

        function generateExecutiveChart() {
            const ctx = document.getElementById('executiveChart').getContext('2d');
            
            if (window.executiveChart) {
                window.executiveChart.destroy();
            }

            // Dados simulados para dashboard executivo
            const quarters = ['Q1', 'Q2', 'Q3', 'Q4'];
            const conformityData = [94.2, 96.1, 97.8, 97.2];
            const costData = [85000, 78000, 72000, 68000];
            const riskData = [3.2, 2.8, 2.1, 2.4];

            window.executiveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: quarters,
                    datasets: [
                        {
                            label: 'Conformidade (%)',
                            data: conformityData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Custos (R$ mil)',
                            data: costData.map(v => v/1000),
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        },
                        {
                            label: '√çndice de Risco',
                            data: riskData,
                            borderColor: '#f59e0b',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y2'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#e5e7eb' }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: '#374151' },
                            ticks: { color: '#e5e7eb' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            grid: { color: '#374151' },
                            ticks: { color: '#10b981' },
                            min: 90,
                            max: 100
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            ticks: { color: '#3b82f6' },
                            min: 60,
                            max: 90
                        },
                        y2: {
                            type: 'linear',
                            display: false,
                            min: 0,
                            max: 5
                        }
                    }
                }
            });
        }

        async function loadIntegrations() {
            // Simular carregamento de integra√ß√µes
            const integrationCards = document.querySelectorAll('.integration-card');
            integrationCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '0.5';
                    card.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        card.style.transition = 'all 0.3s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'scale(1)';
                    }, 100);
                }, index * 200);
            });
        }

        function toggleAIAnalysis() {
            const button = event.target.closest('.btn-ai');
            const isActive = button.classList.contains('active');
            
            if (isActive) {
                button.classList.remove('active');
                button.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    IA Desativada
                `;
                showNotification('IA desativada. Usando an√°lise tradicional.', 'info');
            } else {
                button.classList.add('active');
                button.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    IA Ativada
                `;
                showNotification('IA ativada! An√°lises 90% mais precisas.', 'success');
                initializeAIFeatures();
            }
        }

        function generateExecutiveReport() {
            showNotification('Gerando relat√≥rio executivo...', 'info');
            
            // Simular gera√ß√£o de relat√≥rio
            setTimeout(() => {
                const reportData = {
                    conformidade: '97.2%',
                    economia: 'R$ 14.800',
                    risco: '2.4/10',
                    recomendacoes: [
                        'Redistribuir 12 extintores da recep√ß√£o',
                        'Antecipar manuten√ß√£o de 5 unidades CO2',
                        'Implementar rotina quinzenal no almoxarifado'
                    ]
                };
                
                showNotification('Relat√≥rio executivo gerado com sucesso!', 'success');
                console.log('Relat√≥rio Executivo:', reportData);
            }, 2000);
        }

        function manageIntegrations() {
            showNotification('Abrindo centro de integra√ß√µes...', 'info');
            
            // Simular abertura do centro de integra√ß√µes
            setTimeout(() => {
                showNotification('Centro de integra√ß√µes dispon√≠vel. 4 integra√ß√µes ativas.', 'success');
            }, 1500);
        }

        // ============ FUN√á√ïES DE DEMONSTRA√á√ÉO ============

        async function switchPlanDemo() {
            const selectedPlan = document.getElementById('planSelector').value;
            console.log('üîÑ Alternando para plano:', selectedPlan);
            
            // Limpar interface atual
            document.getElementById('advancedReports').style.display = 'none';
            document.getElementById('enterpriseFeatures').style.display = 'none';
            document.getElementById('upgradeModal').style.display = 'none';
            
            // Limpar header actions (exceto o seletor)
            const headerActions = document.getElementById('headerActions');
            const demoControls = document.getElementById('demoControls');
            headerActions.innerHTML = '';
            headerActions.appendChild(demoControls);
            
            // Aplicar l√≥gica do plano selecionado
            if (selectedPlan === 'starter') {
                showNotification('Modo Starter ativo - Relat√≥rios b√°sicos apenas', 'info');
                adicionarBotaoRelatoriosAvancados();
            } else if (selectedPlan === 'professional') {
                showNotification('Modo Professional ativo - Relat√≥rios avan√ßados desbloqueados!', 'success');
                document.getElementById('advancedReports').style.display = 'block';
                await inicializarRelatoriosAvancados();
                adicionarIndicadorPlano('professional');
            } else if (selectedPlan === 'enterprise') {
                showNotification('Modo Enterprise ativo - Todos os recursos premium!', 'success');
                document.getElementById('advancedReports').style.display = 'block';
                document.getElementById('enterpriseFeatures').style.display = 'block';
                await inicializarRelatoriosAvancados();
                await inicializarRecursosEnterprise();
                adicionarIndicadorPlano('enterprise');
            }
        }

        // Sobrescrever fun√ß√£o original para modo demo
        async function verificarPlanoEMostrarRecursos() {
            try {
                // Em modo demo, usar o seletor
                if (document.getElementById('planSelector')) {
                    const planDemo = document.getElementById('planSelector').value;
                    console.log('üéØ Modo demo ativo - Plano:', planDemo);
                    await switchPlanDemo();
                    return;
                }

                // C√≥digo original para produ√ß√£o
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    console.log('Usu√°rio n√£o autenticado');
                    adicionarBotaoRelatoriosAvancados();
                    return;
                }

                const { data: userData } = await supabase
                    .from('users')
                    .select('plano_ativo')
                    .eq('id', user.id)
                    .single();

                const planAtual = userData?.plano_ativo || 'starter';
                console.log('Plano atual do usu√°rio:', planAtual);
                
                // Verificar se tem acesso a relat√≥rios avan√ßados (PROFESSIONAL ou ENTERPRISE)
                if (PlanValidator.hasFeature(planAtual, 'reports', 'advanced') || 
                    PlanValidator.hasFeature(planAtual, 'reports', 'premium')) {
                    
                    console.log('‚úÖ Usu√°rio tem acesso aos relat√≥rios avan√ßados');
                    document.getElementById('advancedReports').style.display = 'block';
                    await inicializarRelatoriosAvancados();
                    
                    // Adicionar indicador do plano no cabe√ßalho
                    adicionarIndicadorPlano(planAtual);
                    
                    // Se for Enterprise, mostrar recursos exclusivos
                    if (planAtual === 'enterprise') {
                        console.log('üèÜ Ativando recursos Enterprise');
                        document.getElementById('enterpriseFeatures').style.display = 'block';
                        await inicializarRecursosEnterprise();
                    }
                } else {
                    console.log('‚ùå Usu√°rio n√£o tem acesso aos relat√≥rios avan√ßados');
                    // Adicionar bot√£o para acessar relat√≥rios avan√ßados (mostrar√° modal de upgrade)
                    adicionarBotaoRelatoriosAvancados();
                }
            } catch (error) {
                console.error('Erro ao verificar plano:', error);
                adicionarBotaoRelatoriosAvancados();
            }
        }
    </script>

    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .dashboard-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-item.valid {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success-color);
        }

        .stat-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--warning-color);
        }

        .stat-item.expired {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--danger-color);
        }

        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 500;
        }

        .chart-container {
            height: 250px;
            position: relative;
        }

        .filtros-avancados {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
        }

        .filtros-linha {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            align-items: end;
        }

        .periodo-personalizado {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .filtro-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filtro-group label {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .relatorio-resumo {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-color-dark));
            color: white;
            padding: 1.5rem;
            border-radius: var(--radius-lg);
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .resumo-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .resumo-count {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .resumo-filtros {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .resumo-acoes {
            display: flex;
            gap: 0.5rem;
        }

        .btn-mini {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-mini:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Estat√≠sticas por Tipo */
        .selector-tipo {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 0.5rem;
            color: var(--text-primary);
            font-size: 0.875rem;
            min-width: 200px;
        }

        .selector-tipo:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        .stats-display {
            min-height: 200px;
        }

        .tipo-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
            text-align: center;
        }

        .tipo-placeholder svg {
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .tipo-detalhes {
            padding: 1rem;
            animation: fadeIn 0.4s ease-out;
        }

        .tipo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tipo-header h4 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.25rem;
        }

        .tipo-total {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .stats-principais {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detalhes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .detalhe-secao {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
        }

        .detalhe-secao h5 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .lista-detalhes {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .item-detalhe {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: var(--radius-sm);
            transition: background-color 0.2s;
        }

        .item-detalhe:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .item-nome {
            color: var(--text-primary);
            font-weight: 500;
        }

        .item-count {
            background: var(--primary-color);
            color: white;
            padding: 0.125rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }

        .item-detalhe-mais {
            padding: 0.5rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.875rem;
            font-style: italic;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        .filtros-periodo {
            margin-bottom: 1.5rem;
        }

        .filtro-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filtro-group label {
            font-weight: 500;
            color: var(--text-primary);
            min-width: 60px;
        }

        .relatorio-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .relatorio-empty svg {
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .relatorio-resumo {
            background: var(--bg-tertiary);
            padding: 1rem;
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
            text-align: center;
        }

        .relatorio-lista {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .relatorio-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            transition: transform 0.2s;
        }

        .relatorio-item:hover {
            transform: translateY(-1px);
        }

        .relatorio-item.expired {
            border-left: 4px solid var(--danger-color);
        }

        .relatorio-item.warning {
            border-left: 4px solid var(--warning-color);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .item-numero {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .item-details {
            display: grid;
            gap: 0.25rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .item-vencimento {
            font-weight: 500;
            color: var(--text-primary);
        }

        .mini-stat {
            text-align: center;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.05);
        }

        .mini-stat.valid {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--success-color);
        }

        .mini-stat.warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning-color);
        }

        .mini-stat.expired {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid var(--danger-color);
        }

        .mini-number {
            display: block;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .mini-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 500;
        }

        .locais-lista {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .local-item {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
        }

        .local-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .local-nome {
            font-weight: 500;
            color: var(--text-primary);
        }

        .local-count {
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .local-barra {
            background: rgba(255, 255, 255, 0.1);
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
        }

        .barra-progresso {
            background: var(--primary-color);
            height: 100%;
            transition: width 0.3s ease;
        }

        @media (max-width: 640px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .filtros-linha {
                grid-template-columns: 1fr;
            }

            .relatorio-resumo {
                flex-direction: column;
                text-align: center;
            }

            .resumo-acoes {
                width: 100%;
                justify-content: center;
            }

            .chart-container {
                height: 200px;
            }

            .card-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .local-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .stats-principais {
                grid-template-columns: 1fr;
            }

            .detalhes-grid {
                grid-template-columns: 1fr;
            }

            .selector-tipo {
                width: 100%;
                min-width: unset;
            }

            .tipo-header {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dashboard-card {
            animation: fadeIn 0.6s ease-out;
        }

        .relatorio-item {
            animation: fadeIn 0.4s ease-out;
        }

        /* Loading states */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stat-number.loading::after {
            content: '';
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--text-primary);
            animation: spin 1s ease-in-out infinite;
            margin-left: 0.5rem;
        }

        /* Estilos para Relat√≥rios Avan√ßados */
        .advanced-reports-section {
            margin: 2rem 0;
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .section-header h2 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
        }

        .pro-badge {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .predictions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .prediction-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .prediction-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .prediction-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .prediction-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .prediction-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .prediction-change {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .prediction-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .prediction-change.negative {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .prediction-change.neutral {
            background: rgba(156, 163, 175, 0.1);
            color: var(--text-muted);
        }

        .insights-panel {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-top: 1rem;
        }

        .insights-panel h4 {
            color: #3b82f6;
            font-size: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insight-item {
            display: flex;
            align-items: start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .insight-item:last-child {
            margin-bottom: 0;
        }

        .insight-icon {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }

        .insight-text {
            flex: 1;
            font-size: 0.875rem;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .performance-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 0.75rem 1rem;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: rgba(255, 255, 255, 0.05);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .metric-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 1rem;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 500;
        }

        .alerts-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .alert-item {
            display: flex;
            align-items: start;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            margin-bottom: 0.75rem;
        }

        .alert-item:last-child {
            margin-bottom: 0;
        }

        .alert-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .alert-icon.high {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger-color);
        }

        .alert-icon.medium {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning-color);
        }

        .alert-icon.low {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .alert-description {
            font-size: 0.875rem;
            color: var(--text-muted);
            line-height: 1.4;
            margin-bottom: 0.5rem;
        }

        .alert-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .btn-config, .btn-export {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-config:hover, .btn-export:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Modal de Upgrade */
        .upgrade-modal .modal-content {
            max-width: 500px;
            background: var(--bg-secondary);
        }

        .upgrade-content {
            text-align: center;
            padding: 1rem;
        }

        .upgrade-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .upgrade-content h3 {
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            font-size: 1.25rem;
        }

        .upgrade-content p {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .upgrade-features {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(59, 130, 246, 0.05);
            border-radius: var(--radius-sm);
            border-left: 3px solid var(--primary-color);
        }

        .feature-icon {
            font-size: 1.25rem;
        }

        .upgrade-price {
            margin-bottom: 1.5rem;
        }

        .price-label {
            display: block;
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .price-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .btn-upgrade {
            background: linear-gradient(45deg, var(--primary-color), #8b5cf6);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }

        .btn-upgrade:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        /* Bot√£o Premium */
        .btn-premium {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(45deg, var(--primary-color), #8b5cf6);
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-premium::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-premium:hover::before {
            left: 100%;
        }

        .btn-premium:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .pro-badge-mini {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.125rem 0.375rem;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* Screen header melhorada */
        .screen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .screen-header div:first-child h1 {
            margin: 0;
        }

        .screen-header div:first-child p {
            margin: 0.25rem 0 0 0;
            color: var(--text-muted);
        }

        /* Indicador de Plano */
        .plan-indicator {
            display: flex;
            align-items: center;
        }

        .plan-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .plan-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 2s ease;
        }

        .plan-badge:hover::before {
            left: 100%;
        }

        .plan-icon {
            font-size: 1.125rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .plan-name {
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Recursos Enterprise */
        .enterprise-features-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 2px solid;
            border-image: linear-gradient(45deg, #8b5cf6, #ec4899) 1;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(236, 72, 153, 0.05));
        }

        .enterprise-badge {
            background: linear-gradient(45deg, #8b5cf6, #ec4899);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 12px rgba(236, 72, 153, 0.3);
            position: relative;
            overflow: hidden;
        }

        .enterprise-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 1.5s ease infinite;
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .ai-insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .ai-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .ai-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            animation: aiPulse 2s ease-in-out infinite;
        }

        @keyframes aiPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .ai-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            display: block;
        }

        .ai-content h4 {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .ai-content p {
            color: var(--text-muted);
            font-size: 0.875rem;
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }

        .ai-metric {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            padding: 0.375rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }

        .btn-ai, .btn-executive, .btn-integration {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(45deg, #8b5cf6, #ec4899);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-ai::before, .btn-executive::before, .btn-integration::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-ai:hover::before, .btn-executive:hover::before, .btn-integration:hover::before {
            left: 100%;
        }

        .btn-ai:hover, .btn-executive:hover, .btn-integration:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 25px rgba(236, 72, 153, 0.4);
        }

        .executive-dashboard {
            margin: 1rem 0;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .kpi-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .kpi-card.critical {
            border-left: 4px solid #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
        }

        .kpi-card.success {
            border-left: 4px solid #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), transparent);
        }

        .kpi-card.warning {
            border-left: 4px solid #f59e0b;
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), transparent);
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .kpi-label {
            font-size: 0.875rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .kpi-trend {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .kpi-trend.up {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .kpi-trend.down {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .integrations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .integration-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .integration-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .integration-card.active {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
        }

        .integration-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .integration-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .integration-status {
            font-size: 0.875rem;
            color: var(--text-muted);
        }
    </style>
    
    <!-- <script src="../js/pwa-manager.js"></script> -->
</body>
</html>
