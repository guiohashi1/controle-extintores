<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Integração Admin</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .admin-test {
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .success { background: #e8f5e8; border-color: #4caf50; }
        .error { background: #ffe8e8; border-color: #f44336; }
        .info { background: #e8f4ff; border-color: #2196f3; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            margin: 0.25rem;
        }
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <!-- Container da Navbar -->
    <div id="navbar-container"></div>

    <div class="admin-test">
        <h1><i class="fas fa-tools"></i> Teste Integração Admin</h1>
        
        <div class="test-section info">
            <h3>ℹ️ Informações</h3>
            <p>Esta página testa se a integração do painel admin está funcionando corretamente.</p>
            <p><strong>Usuário Admin de Teste:</strong> admin@teste.com | Senha: admin123</p>
        </div>

        <div class="test-section" id="user-status">
            <h3>👤 Status do Usuário</h3>
            <p id="user-info">Carregando...</p>
            <button class="test-button" onclick="checkUserStatus()">🔍 Verificar Status</button>
        </div>

        <div class="test-section" id="admin-status">
            <h3>👑 Status Admin</h3>
            <p id="admin-info">Carregando...</p>
            <button class="test-button" onclick="checkAdminStatus()">🔍 Verificar Admin</button>
        </div>

        <div class="test-section" id="navbar-test">
            <h3>🧭 Teste Navbar</h3>
            <p id="navbar-info">Carregando...</p>
            <button class="test-button" onclick="testNavbar()">🔍 Testar Navbar</button>
        </div>

        <div class="test-section" id="login-test">
            <h3>🔐 Teste de Login Admin</h3>
            <div style="display: flex; gap: 1rem; align-items: center; margin: 1rem 0;">
                <input type="email" id="test-email" placeholder="Email" value="admin@teste.com" style="padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                <input type="password" id="test-password" placeholder="Senha" value="admin123" style="padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px;">
                <button class="test-button" onclick="testAdminLogin()">🔐 Login Admin</button>
            </div>
            <p id="login-info">Clique em "Login Admin" para testar</p>
        </div>

        <div class="test-section" id="admin-panel-test">
            <h3>🎛️ Teste Painel Admin</h3>
            <p id="panel-info">Faça login como admin primeiro</p>
            <button class="test-button" onclick="testAdminPanel()" disabled id="panel-btn">🎛️ Abrir Painel</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/supabase-config.js"></script>
    <script src="../js/common.js"></script>
    <script>
        // Inicializar página
        document.addEventListener('DOMContentLoaded', async () => {
            await loadNavbarComponent();
            checkUserStatus();
            checkAdminStatus();
            testNavbar();
        });

        // Verificar status do usuário
        function checkUserStatus() {
            const user = supabase.currentUser;
            const statusDiv = document.getElementById('user-status');
            const infoP = document.getElementById('user-info');
            
            if (user) {
                infoP.innerHTML = `
                    ✅ <strong>Usuário Logado:</strong><br>
                    📧 Email: ${user.email}<br>
                    👤 Nome: ${user.name}<br>
                    📦 Plano: ${user.plan}<br>
                    🆔 ID: ${user.id}
                `;
                statusDiv.className = 'test-section success';
            } else {
                infoP.innerHTML = '❌ <strong>Nenhum usuário logado</strong>';
                statusDiv.className = 'test-section error';
            }
        }

        // Verificar status admin
        function checkAdminStatus() {
            const adminDiv = document.getElementById('admin-status');
            const infoP = document.getElementById('admin-info');
            
            if (typeof isAdmin === 'function') {
                const userIsAdmin = isAdmin();
                if (userIsAdmin) {
                    infoP.innerHTML = '✅ <strong>Usuário é ADMIN</strong> - Botão admin deve estar visível';
                    adminDiv.className = 'test-section success';
                    document.getElementById('panel-btn').disabled = false;
                } else {
                    infoP.innerHTML = '❌ <strong>Usuário NÃO é admin</strong> - Botão admin deve estar oculto';
                    adminDiv.className = 'test-section error';
                    document.getElementById('panel-btn').disabled = true;
                }
            } else {
                infoP.innerHTML = '❌ <strong>Função isAdmin não encontrada</strong>';
                adminDiv.className = 'test-section error';
            }
        }

        // Testar navbar
        function testNavbar() {
            const navbarDiv = document.getElementById('navbar-test');
            const infoP = document.getElementById('navbar-info');
            
            const adminElements = document.querySelectorAll('.admin-only');
            if (adminElements.length > 0) {
                const visibleCount = Array.from(adminElements).filter(el => el.style.display !== 'none').length;
                infoP.innerHTML = `
                    ✅ <strong>Navbar carregada:</strong><br>
                    🔍 Elementos admin encontrados: ${adminElements.length}<br>
                    👁️ Elementos admin visíveis: ${visibleCount}
                `;
                navbarDiv.className = 'test-section success';
            } else {
                infoP.innerHTML = '❌ <strong>Elementos admin não encontrados na navbar</strong>';
                navbarDiv.className = 'test-section error';
            }
        }

        // Testar login admin
        async function testAdminLogin() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            const infoP = document.getElementById('login-info');
            
            try {
                infoP.innerHTML = '⏳ Fazendo login...';
                
                const result = await supabase.login(email, password);
                
                if (result) {
                    infoP.innerHTML = '✅ <strong>Login realizado com sucesso!</strong>';
                    document.getElementById('login-test').className = 'test-section success';
                    
                    // Atualizar outros testes
                    setTimeout(() => {
                        checkUserStatus();
                        checkAdminStatus();
                        testNavbar();
                    }, 500);
                } else {
                    infoP.innerHTML = '❌ <strong>Falha no login</strong> - Verifique email/senha ou se o usuário admin foi criado no Supabase';
                    document.getElementById('login-test').className = 'test-section error';
                }
            } catch (error) {
                infoP.innerHTML = `❌ <strong>Erro no login:</strong> ${error.message}`;
                document.getElementById('login-test').className = 'test-section error';
            }
        }

        // Testar painel admin
        function testAdminPanel() {
            if (typeof navigateToAdmin === 'function') {
                navigateToAdmin();
            } else {
                document.getElementById('panel-info').innerHTML = '❌ Função navigateToAdmin não encontrada';
                document.getElementById('admin-panel-test').className = 'test-section error';
            }
        }
    </script>
</body>
</html>
